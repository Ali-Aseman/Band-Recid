<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>رسید بانکی</title>
  <style>
    @font-face {
      font-family: 'IranSans';
      src: url('/fonts/IranSans.ttf') format('truetype');
    }

    body {
      font-family: 'IranSans', sans-serif;
      background: #f3f3f3;
      text-align: center;
      direction: rtl;
    }

    #receiptCanvas {
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    form {
      margin-top: 20px;
    }

    input {
      padding: 8px;
      margin: 6px;
      width: 300px;
    }

    button {
      padding: 10px 20px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>فرم رسید بانکی</h1>
  <form id="receiptForm">
    <input type="text" id="amount" placeholder="مبلغ (ریال)" required /><br />
    <input type="text" id="trackingCode" placeholder="کد پیگیری" required /><br />
    <input type="text" id="cardFrom" placeholder="شماره کارت مبدا (16 رقمی)" required /><br />
    <input type="text" id="cardTo" placeholder="شماره کارت مقصد (16 رقمی)" required /><br />
    <button type="submit">نمایش رسید</button>
  </form>

  <canvas id="receiptCanvas" width="800" height="1200"></canvas>

  <script>
    const form = document.getElementById('receiptForm');
    const canvas = document.getElementById('receiptCanvas');
    const ctx = canvas.getContext('2d');

    function formatCardNumber(number) {
      if (!/^\d{16}$/.test(number)) return 'شماره نامعتبر';
      return number
        .replace(/(\d{4})(\d{2})(\d{6})(\d{4})/, (m, a, b, c, d) => {
          return `${a}-${'*'.repeat(2)}${'*'.repeat(4)}${'*'.repeat(2)}-${d}`;
        });
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const amount = document.getElementById('amount').value;
      const trackingCode = document.getElementById('trackingCode').value;
      const cardFrom = document.getElementById('cardFrom').value;
      const cardTo = document.getElementById('cardTo').value;

      if (cardFrom.length !== 16 || cardTo.length !== 16) {
        alert('شماره کارت‌ها باید دقیقاً ۱۶ رقمی باشند.');
        return;
      }

      const img = new Image();
      img.src = '/images/background.jpg';
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        ctx.font = '28px IranSans';
        ctx.fillStyle = 'black';

        const now = new Date();
        const date = now.toLocaleDateString('fa-IR');
        const time = now.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });

        ctx.fillText(`تاریخ: ${date} | ساعت: ${time} | پیگیری: ${trackingCode}`, 100, 300);
        ctx.fillText(`مبلغ: ${amount} ریال`, 100, 360);
        ctx.fillText(`مبدا: ${formatCardNumber(cardFrom)}`, 100, 420);
        ctx.fillText(`مقصد: ${formatCardNumber(cardTo)}`, 100, 480);

        ctx.font = 'bold 30px IranSans';
        const bankName = Math.random() < 0.5 ? 'پست بانک' : 'بانک مهر';
        ctx.fillText(bankName, 100, 150);
        ctx.font = '24px IranSans';
        ctx.fillText('ورامین جدید', 100, 190);
        ctx.fillText('خدمات سحاب - رسید انتقال وجه', 100, 230);
      };
    });
  </script>
</body>
</html>
